Documentación: Configuración de Sistema de Envío de Correos en Oracle
1. Requisitos Previos

Oracle Database 21c o superior
Acceso SYSDBA
Servidor SMTP local en puerto 2525

2. Proceso de Implementación
2.1 Crear Usuario y Asignar Permisos Básicos
sqlCopyCONNECT / AS SYSDBA
ALTER SESSION SET CONTAINER = XEPDB1;

CREATE USER [nuevo_usuario] IDENTIFIED BY [password];
GRANT CREATE SESSION TO [nuevo_usuario];
2.2 Otorgar Permisos de Sistema
sqlCopy-- Permisos de correo
GRANT EXECUTE ON UTL_SMTP TO [nuevo_usuario];
GRANT EXECUTE ON UTL_TCP TO [nuevo_usuario];
GRANT EXECUTE ON UTL_INADDR TO [nuevo_usuario];
GRANT SELECT ON DBA_NETWORK_ACLS TO [nuevo_usuario];
GRANT EXECUTE ON DBMS_ALERT TO [nuevo_usuario];
GRANT EXECUTE ON DBMS_NETWORK_ACL_ADMIN TO [nuevo_usuario];

-- Permisos de desarrollo
GRANT CREATE TABLE, CREATE VIEW TO [nuevo_usuario];
GRANT CREATE SEQUENCE, CREATE PROCEDURE TO [nuevo_usuario];
GRANT CREATE SYNONYM, CREATE TRIGGER TO [nuevo_usuario];
GRANT UNLIMITED TABLESPACE TO [nuevo_usuario];
GRANT CONNECT, RESOURCE TO [nuevo_usuario];
2.3 Configuración ACL (Crítico)
sqlCopyBEGIN
  DBMS_NETWORK_ACL_ADMIN.CREATE_ACL(
    acl => 'smtp_acl_[nuevo_usuario].xml',
    description => 'SMTP Access for [nuevo_usuario]',
    principal => '[NUEVO_USUARIO]',
    is_grant => TRUE,
    privilege => 'connect'
  );
  
  DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(
    acl => 'smtp_acl_[nuevo_usuario].xml',
    host => 'localhost'
  );
  COMMIT;
END;
/
2.4 Crear Procedimiento de Envío
sqlCopyCREATE OR REPLACE PROCEDURE [nuevo_usuario].enviar_correo_simple
IS
    v_mailhost    VARCHAR2(255) := 'localhost';
    v_port        NUMBER := 2525;
    v_from        VARCHAR2(255) := 'remitente@dominio.com';
    v_to          VARCHAR2(255) := 'destinatario@dominio.com';
    v_subject     VARCHAR2(255) := 'Asunto';
    v_message     VARCHAR2(4000) := 'Mensaje';
    v_mail_conn   UTL_SMTP.connection;
    v_crlf        VARCHAR2(2) := CHR(13) || CHR(10);
BEGIN
    v_mail_conn := UTL_SMTP.open_connection(v_mailhost, v_port);
    UTL_SMTP.helo(v_mail_conn, v_mailhost);
    UTL_SMTP.mail(v_mail_conn, v_from);
    UTL_SMTP.rcpt(v_mail_conn, v_to);
    UTL_SMTP.open_data(v_mail_conn);
    UTL_SMTP.write_data(v_mail_conn, 'From: ' || v_from || v_crlf);
    UTL_SMTP.write_data(v_mail_conn, 'To: ' || v_to || v_crlf);
    UTL_SMTP.write_data(v_mail_conn, 'Subject: ' || v_subject || v_crlf || v_crlf);
    UTL_SMTP.write_data(v_mail_conn, v_message || v_crlf);
    UTL_SMTP.close_data(v_mail_conn);
    UTL_SMTP.quit(v_mail_conn);
EXCEPTION
    WHEN OTHERS THEN
        DBMS_OUTPUT.PUT_LINE('Error: ' || SQLERRM);
END;
/
3. Importancia de la Configuración ACL

Proporciona control de acceso a nivel de red
Requerido para conexiones SMTP
Específico para cada usuario
Sin ACL, las conexiones serán rechazadas con ORA-24247
El nombre del archivo ACL debe ser único
La asignación a 'localhost' es crítica para SMTP local

4. Prueba de Funcionamiento
sqlCopySET SERVEROUTPUT ON;
BEGIN
  [nuevo_usuario].enviar_correo_simple;
END;
/
5. Consideraciones Importantes

Cada usuario requiere su propio ACL
Los nombres de ACL deben ser únicos
El servidor SMTP debe estar activo
Los permisos son acumulativos y necesarios
El procedimiento es independiente de la configuración ACL


















GRANT CREATE TABLE TO haraka; 
GRANT CREATE VIEW TO haraka; 
GRANT CREATE SEQUENCE TO haraka; 
GRANT CREATE PROCEDURE TO haraka; 
GRANT CREATE SYNONYM TO haraka; 
GRANT UNLIMITED TABLESPACE TO haraka; 
GRANT CREATE SESSION TO haraka; 
GRANT CREATE TRIGGER TO haraka; 
GRANT CREATE SEQUENCE TO haraka; 
GRANT CREATE TABLE TO haraka; 
GRANT UNLIMITED TABLESPACE TO haraka; 
GRANT CONNECT, RESOURCE TO haraka; 
GRANT CREATE SESSION, CREATE TABLE, CREATE PROCEDURE, CREATE TRIGGER TO haraka; 




-- Permisos de correo
GRANT EXECUTE ON UTL_SMTP TO haraka;
GRANT EXECUTE ON UTL_TCP TO haraka;
GRANT EXECUTE ON UTL_INADDR TO haraka;
GRANT SELECT ON DBA_NETWORK_ACLS TO haraka;
GRANT EXECUTE ON DBMS_ALERT TO haraka;
GRANT EXECUTE ON DBMS_NETWORK_ACL_ADMIN TO haraka;

-- Permisos de desarrollo
GRANT CREATE TABLE, CREATE VIEW TO haraka;
GRANT CREATE SEQUENCE, CREATE PROCEDURE TO haraka;
GRANT CREATE SYNONYM, CREATE TRIGGER TO haraka;
GRANT UNLIMITED TABLESPACE TO haraka;
GRANT CONNECT, RESOURCE TO haraka;



BEGIN
  DBMS_NETWORK_ACL_ADMIN.CREATE_ACL(
    acl => 'smtp_acl_haraka.xml',
    description => 'SMTP Access for haraka',
    principal => 'HARAKA',
    is_grant => TRUE,
    privilege => 'connect'
  );
  
  DBMS_NETWORK_ACL_ADMIN.ASSIGN_ACL(
    acl => 'smtp_acl_haraka.xml',
    host => 'localhost'
  );
  COMMIT;
END;
/






CREATE OR REPLACE PROCEDURE haraka.enviar_correo_simple 
IS
   v_mailhost    VARCHAR2(255) := 'localhost';
   v_port        NUMBER := 2525;
   v_from        VARCHAR2(255) := 'cacereshilasacajhack@gmail.com';
   v_to          VARCHAR2(255) := 'cacereshilasacajhack@gmail.com';
   v_subject     VARCHAR2(255) := 'Prueba de relay SMTP desde Oracle';
   v_message     VARCHAR2(4000) := 'Este correo fue enviado a través de Haraka como relay SMTP';
   v_mail_conn   UTL_SMTP.connection;
   v_crlf        VARCHAR2(2) := CHR(13) || CHR(10);
BEGIN
   v_mail_conn := UTL_SMTP.open_connection(v_mailhost, v_port);
   UTL_SMTP.helo(v_mail_conn, v_mailhost);
   UTL_SMTP.mail(v_mail_conn, v_from);
   UTL_SMTP.rcpt(v_mail_conn, v_to);
   UTL_SMTP.open_data(v_mail_conn);
   UTL_SMTP.write_data(v_mail_conn, 'From: ' || v_from || v_crlf);
   UTL_SMTP.write_data(v_mail_conn, 'To: ' || v_to || v_crlf);
   UTL_SMTP.write_data(v_mail_conn, 'Subject: ' || v_subject || v_crlf);
   UTL_SMTP.write_data(v_mail_conn, v_crlf);
   UTL_SMTP.write_data(v_mail_conn, v_message || v_crlf);
   UTL_SMTP.close_data(v_mail_conn);
   UTL_SMTP.quit(v_mail_conn);
   DBMS_OUTPUT.PUT_LINE('Correo enviado exitosamente.');
EXCEPTION
   WHEN OTHERS THEN
       DBMS_OUTPUT.PUT_LINE('Error al enviar el correo: ' || SQLERRM);
END;
/