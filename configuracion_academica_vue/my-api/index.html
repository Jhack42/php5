<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construir HTML desde APIs</title>
    <script>
        // Función para crear un elemento HTML y aplicarle estilos
        async function fetchAndBuild(apiUrl) {
            const response = await fetch(apiUrl);
            const data = await response.json();
            
            const element = await createElementFromJson(data);

            if (data.api_css) {
                await applyCssFromApi(data.api_css, element);
            }

            return element;
        }

        // Función para crear un elemento HTML a partir de JSON
        async function createElementFromJson(json) {
            const element = document.createElement(json.tag);

            if (json.content) {
                element.textContent = json.content;
            }

            if (json.attributes) {
                for (const [key, value] of Object.entries(json.attributes)) {
                    element.setAttribute(key, value);
                }
            }

            if (json.api) {
                const childJson = await fetchAndBuild(json.api);
                element.appendChild(childJson);
            }

            if (json.children) {
                for (const child of json.children) {
                    const childElement = await createElementFromJson(child);
                    element.appendChild(childElement);
                }
            }

            return element;
        }

        // Función para aplicar CSS a un elemento a partir de una API
        async function applyCssFromApi(apiCssUrl, element) {
            const response = await fetch(apiCssUrl);
            const cssData = await response.json();

            for (const [property, value] of Object.entries(cssData.styles)) {
                element.style[property] = value;
            }
        }

        window.onload = async function () {
            const apiUrl = 'http://127.0.0.1:3000/api/proyecto/1'; // Cambia localhost a 127.0.0.1
            const rootElement = await fetchAndBuild(apiUrl);
            document.body.appendChild(rootElement);
        }
    </script>
</head>
<body>
</body>
</html>
