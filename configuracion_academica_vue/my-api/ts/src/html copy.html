<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Árbol de Facultades y Especialidades</title>
    <style>
        ul {
            list-style-type: none;
            margin-left: 20px;
            padding-left: 0;
        }

        li {
            margin: 5px 0;
            position: relative;
        }

        .folder-content {
            display: none;
            transition: max-height 0.3s ease-out;
        }

        .arrow {
            cursor: pointer;
            width: 16px;
            height: 16px;
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
        }

        .arrow.collapsed {
            transform: rotate(-90deg);
        }

        li span {
            cursor: pointer;
        }
    </style>
    <script>
        async function fetchTreeStructure() {
            try {
                const response = await fetch('http://localhost:3000/api/arbol');
                if (!response.ok) {
                    throw new Error('Error al cargar la estructura');
                }
                const data = await response.json();
                createTree(data, document.getElementById('tree-container'));
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function createTree(data, container) {
            const rootUl = document.createElement('ul');
            const rootLi = document.createElement('li');

            rootLi.innerHTML = `<span>${data.name}</span>`;
            rootLi.appendChild(createCheckbox());

            const eventUl = createEventList(data.evento);
            const facultadesUl = createFacultadList(data.facultades);

            rootLi.appendChild(eventUl);
            rootLi.appendChild(facultadesUl);
            rootUl.appendChild(rootLi);

            container.appendChild(rootUl);
        }

        function createCheckbox() {
            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.addEventListener('change', function (e) {
                const children = e.target.closest('li').querySelectorAll('input[type="checkbox"]');
                children.forEach(child => {
                    child.checked = e.target.checked;
                });
            });
            return checkbox;
        }

        function createEventList(eventos) {
            const ul = document.createElement('ul');
            eventos.forEach(evento => {
                const li = document.createElement('li');
                li.textContent = evento;
                li.appendChild(createCheckbox());
                ul.appendChild(li);
            });
            return ul;
        }

        function createFacultadList(facultades) {
            const ul = document.createElement('ul');
            facultades.forEach(facultad => {
                const li = document.createElement('li');
                const arrow = createArrow();
                const span = document.createElement('span');
                span.textContent = facultad.name;

                li.appendChild(arrow);
                li.appendChild(span);
                li.appendChild(createCheckbox());

                const eventUl = createEventList(facultad.evento);
                const especialidadesUl = createEspecialidadList(facultad.carpeta);

                const folderContent = document.createElement('div');
                folderContent.classList.add('folder-content');
                folderContent.appendChild(eventUl);
                folderContent.appendChild(especialidadesUl);

                li.appendChild(folderContent);
                ul.appendChild(li);

                arrow.addEventListener('click', function () {
                    toggleFolder(folderContent, arrow);
                });
            });
            return ul;
        }

        function createEspecialidadList(especialidades) {
            const ul = document.createElement('ul');
            especialidades.forEach(especialidad => {
                const li = document.createElement('li');
                const arrow = createArrow();
                const span = document.createElement('span');
                span.textContent = especialidad.name;

                li.appendChild(arrow);
                li.appendChild(span);
                li.appendChild(createCheckbox());

                const eventUl = createEventList(especialidad.evento);
                const folderContent = document.createElement('div');
                folderContent.classList.add('folder-content');
                folderContent.appendChild(eventUl);

                li.appendChild(folderContent);
                ul.appendChild(li);

                arrow.addEventListener('click', function () {
                    toggleFolder(folderContent, arrow);
                });
            });
            return ul;
        }

        // Crear el ícono de flecha (SVG)
        function createArrow() {
            const arrow = document.createElement('div');
            arrow.innerHTML = `
                <svg class="arrow collapsed" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M7 10l5 5 5-5H7z"/>
                </svg>
            `;
            return arrow.firstElementChild;
        }

        // Función para expandir o colapsar las carpetas
        function toggleFolder(folderContent, arrow) {
            if (folderContent.style.display === 'none' || folderContent.style.display === '') {
                folderContent.style.display = 'block';
                arrow.classList.remove('collapsed');
            } else {
                folderContent.style.display = 'none';
                arrow.classList.add('collapsed');
            }
        }

        window.onload = function () {
            fetchTreeStructure();
        }
    </script>
</head>
<body>
    <h1>Árbol de Facultades y Especialidades</h1>
    <div id="tree-container"></div>
</body>
</html>
